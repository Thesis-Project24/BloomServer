generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = "postgresql://postgres:root@localhost:5432/bloom"
}

model User {
  id              Int           @id @default(autoincrement())
  email           String        @unique
  username        String        @unique
  first_name      String
  last_name       String
  profile_picture String?
  phone_number    String?
  age             Int?
  mood            Json[]
  appointments    Appointment[]
  tags            Comment[]     @relation("tag")
  comments        Comment[]     @relation("author")
  forumPosts      ForumPost[]
  journalPosts    Journal[]
  meds            MedSchedule[]
  savedArticles   SaveArticle[]
  trackedHabits   TrackHabit[]
  groups          Group[]       @relation("GroupToUser")
  slots           Slot[]        @relation("waitlist")
}

model Doctor {
  id              Int           @id @default(autoincrement())
  email           String        @unique
  first_name      String
  last_name       String
  specialty       String?
  profile_picture String?
  phone_number    String?
  address         String[]      @default([])
  bio             String?
  rate            Int?
  review          Int?
  gender          String?
  appointment     Appointment[]
  articles         Article[]
  groups          Group[]
  window          window[]
}

model Meds {
  id        Int           @id @default(autoincrement())
  name      String        @unique
  schedules MedSchedule[]
}

model Journal {
  id       Int    @id @default(autoincrement())
  content  String
  title    String
  authorId Int
  author   User   @relation(fields: [authorId], references: [id])
}

model Appointment {
  id          Int     @id @default(autoincrement())
  patientId   Int
  doctorId    Int
  appDetails  String?
  appStatus   String  @default("available")
  appReview   Int @default(0)
  appFeedback String?
  slotId      Int     @unique
  doctor      Doctor  @relation(fields: [doctorId], references: [id])
  patient     User    @relation(fields: [patientId], references: [id])
  slot        Slot    @relation(fields: [slotId], references: [id])
}

model Slot {
  id           Int          @id @default(autoincrement())
  windowId     Int
  startingTime DateTime
  endingTime   DateTime
  appointment  Appointment?
  window       window       @relation(fields: [windowId], references: [id])
  waitlist     User[]       @relation("waitlist")
}

model ForumPost {
  id       Int       @id @default(autoincrement())
  content  String
  upvote   Int?
  downvote Int?
  authorId Int
  comments Comment[]
  author   User      @relation(fields: [authorId], references: [id])
  flairs   Flair[]   @relation("FlairToForumPost")
}

model Comment {
  id         Int       @id @default(autoincrement())
  content    String
  upvote     Int?
  downvote   Int?
  postId     Int
  userId     Int
  tagId      Int?
  post       ForumPost @relation(fields: [postId], references: [id])
  taggedUser User?     @relation("tag", fields: [tagId], references: [id])
  User       User      @relation("author", fields: [userId], references: [id])
}

model Article {
  id       Int           @id @default(autoincrement())
  content  String
  authorId Int
  author   Doctor        @relation(fields: [authorId], references: [id])
  saved    SaveArticle[]
}

model Flair {
  id    Int         @id @default(autoincrement())
  name  String      @unique
  posts ForumPost[] @relation("FlairToForumPost")
}

model Group {
  id           Int    @id @default(autoincrement())
  name         String
  doctorId     Int
  doctor       Doctor @relation(fields: [doctorId], references: [id])
  participants User[] @relation("GroupToUser")
}

model SaveArticle {
  id        Int     @id @default(autoincrement())
  articleId Int
  userId    Int
  article   Article @relation(fields: [articleId], references: [id])
  user      User    @relation(fields: [userId], references: [id])
}

model MedSchedule {
  id         Int        @id @default(autoincrement())
  medId      Int
  userId     Int
  quantity   Int
  schedule   DateTime[]
  medication Meds       @relation(fields: [medId], references: [id])
  user       User       @relation(fields: [userId], references: [id])
}

model Habit {
  id       Int          @id @default(autoincrement())
  name     String       @unique
  tracking TrackHabit[]
}

model TrackHabit {
  id      Int    @id @default(autoincrement())
  habitId Int
  userId  Int
  tracker Json[]
  habit   Habit  @relation(fields: [habitId], references: [id])
  user    User   @relation(fields: [userId], references: [id])
}

model window {
  id           Int      @id @default(autoincrement())
  doctorId     Int
  startingTime String
  endingTime   String
  duration     Int
  pause        Int
  slots        Slot[]
  doctor       Doctor   @relation(fields: [doctorId], references: [id])
}